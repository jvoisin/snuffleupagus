set SUGAR_REAL_ROOT_RX "^(/mnt/sugar)?/+[0-9]+\.[0-9]\.[0-9][0-9A-Za-z_-]*/+(ent|pro)/([^\./][^/]*/)*[^\./][^/]*\.php$";
set SUGAR_LOADER_RX "^(/mnt/sugar)?/+(borg/+)?[^\./][^/]*\.php$";
set SUGAR_SHADOW_UPLOAD_RX "^(/mnt/sugar)?/shadowed/[0-9A-Za-z_-]+\.msdev\.sugarcrm\.com/upload/([^\./][^/]*/)*[^\./][^/]*$";
set SUGAR_SHADOW_CUSTOM_RX "^(/mnt/sugar)?/shadowed/[0-9A-Za-z_-]+\.msdev\.sugarcrm\.com/custom/([^\./][^/]*/)*[^\./][^/]*$";
set SUGAR_SHADOW_RX "^(/mnt/sugar)?/shadowed/[0-9A-Za-z_-]+\.msdev\.sugarcrm\.com/";
set NANNYBOT_RX "^/opt/nannybot/versions/(current|[0-9]+)/(bin|tasks(/php_lib)?)/[^\./][^/]*\.php$";
set PUPPET_HELPER_RX "^/opt/puppet/helpers/[^\./][^/]*\.php$";
set WEBROOT_RX "^/var/www/html/[^\./][^/]*\.php$";
set TMP_RX "^/tmp/[^\.][^/]*(/[^\.][^/]*)*$";
set PEAR_RX "^/usr/share/pear/";
set UPGRADER_RX "^phar://(/mnt/sugar)?/+[0-9]+\.[0-9]\.[0-9][0-9A-Za-z_-]*/+(shadowUpgrade|sortinghat)-[0-9]+\.[0-9]\.[0-9]\.phar/";
sp.harden_random.enable();
sp.wrappers_whitelist.list("file,php,phar,data,http,https");
sp.wrappers_whitelist.php_list("stdout,stdin,stderr,memory,input,temp,output,fd");
sp.eval_blacklist.list("exec,system,shell_exec,pcntl_exec,unserialize,eval,ioctl,passthru,popen,proc_open");
sp.disable_function.function("putenv").param("assignment").value_r("^LD_").drop();
sp.disable_function.function("putenv").param("assignment").value("PATH").drop();
sp.disable_function.function("putenv").param("assignment").value_r("^GCONV_").drop();
sp.disable_function.function("curl_setopt").param("option").value("32").drop().alias("Please don't set CURLOPT_SSLVERSION.");
sp.disable_function.function("curl_setopt").param("option").value("84").drop().alias("Please don't set CURLOPT_HTTP_VERSION.");
sp.disable_function.function("curl_setopt").param("option").value("56").drop().alias("Please don't set CURLOPT_PROGRESSFUNCTION.");
sp.disable_function.function("curl_setopt").param("option").value("79").drop().alias("Please don't set CURLOPT_HEADERFUNCTION.");
sp.disable_function.function("curl_setopt").param("option").value("12").drop().alias("Please don't set CURLOPT_READFUNCTION.");
sp.disable_function.function("curl_setopt").param("option").value("11").drop().alias("Please don't set CURLOPT_WRITEFUNCTION.");
sp.disable_function.function("curl_setopt").param("option").value("219").drop().alias("Please don't set CURLOPT_XFERINFOFUNCTION.");
sp.disable_function.function("curl_setopt").param("option").value("96").drop().alias("Please don't set CURLOPT_CAPATH.");
sp.disable_function.function("curl_setopt").param("option").value("65").drop().alias("Please don't set CURLOPT_CAINFO.");
sp.disable_function.function("curl_setopt").param("option").value("41").drop().alias("Please don't set CURLOPT_VERBOSE.");
sp.disable_function.function("curl_setopt").param("option").value("216").drop().alias("Please don't set CURLOPT_SSL_OPTIONS.");
sp.disable_function.function("curl_setopt").param("option").value("221").drop().alias("Please don't set CURLOPT_DNS_INTERFACE.");
sp.disable_function.function("curl_setopt").param("option").value("222").drop().alias("Please don't set CURLOPT_DNS_LOCAL_IP4.");
sp.disable_function.function("curl_setopt").param("option").value("223").drop().alias("Please don't set CURLOPT_DNS_LOCAL_IP6.");
sp.disable_function.function("curl_setopt").param("option").value("77").drop().alias("Please don't set CURLOPT_EGDSOCKET.");
sp.disable_function.function("curl_setopt").param("option").value("83").drop().alias("Please don't set CURLOPT_SSL_CIPHER_LIST.");
sp.disable_function.function("curl_setopt").param("option").value("276").drop().alias("Please don't set CURLOPT_TLS13_CIPHERS.");
sp.disable_function.function("curl_setopt").param("option").value("231").drop().alias("Please don't set CURLOPT_UNIX_SOCKET_PATH.");
sp.disable_function.function("curl_setopt").filename_r(SUGAR_SHADOW_RX).param("option").value("64").drop().alias("Please don't set CURLOPT_SSL_VERIFYPEER.");
sp.disable_function.function("curl_setopt").filename_r(SUGAR_SHADOW_RX).param("option").value("81").drop().alias("Please don't set CURLOPT_SSL_VERIFYHOST.");
sp.disable_function.function("curl_setopt").filename_r(SUGAR_SHADOW_RX).param("option").value("3").drop().alias("Please don't set CURLOPT_PORT.");
sp.disable_function.function("curl_setopt").filename_r(SUGAR_SHADOW_RX).param("option").value("43").drop().alias("Please don't set CURLOPT_NOPROGRESS.");
sp.disable_function.function("curl_setopt").param("value").value_r("file://").drop().alias("file:// protocol is disabled");
sp.disable_function.function("curl_init").param("url").value_r("file://").drop().alias("file:// protocol is disabled");
sp.disable_function.function("eval").filename_r(SUGAR_REAL_ROOT_RX).allow();
sp.disable_function.function("eval").filename_r(SUGAR_SHADOW_RX).drop();
sp.disable_function.function("eval").allow();
sp.disable_function.function("ioctl").filename_r(SUGAR_REAL_ROOT_RX).allow();
sp.disable_function.function("ioctl").drop();
sp.disable_function.function("exec").filename_r(SUGAR_REAL_ROOT_RX).allow();
sp.disable_function.function("exec").filename_r("^/usr/local/bin/").allow();
sp.disable_function.function("exec").drop();
sp.disable_function.function("system").filename_r(NANNYBOT_RX).allow();
sp.disable_function.function("system").drop();
sp.disable_function.function("shell_exec").drop();
sp.disable_function.function("pcntl_exec").filename_r("^/usr/local/bin/").allow();
sp.disable_function.function("pcntl_exec").drop();
sp.disable_function.function("passthru").filename_r(SUGAR_REAL_ROOT_RX).allow();
sp.disable_function.function("passthru").filename_r(SUGAR_SHADOW_RX).drop();
sp.disable_function.function("passthru").allow();
sp.disable_function.function("popen").filename_r(NANNYBOT_RX).allow();
sp.disable_function.function("popen").drop();
sp.disable_function.function_r("^ZipArchive::").filename_r(SUGAR_REAL_ROOT_RX).allow();
sp.disable_function.function_r("^ZipArchive::").drop();
sp.disable_function.function_r("^Archive_Tar::").drop();
sp.ini_protection.disable();
# this is a pretty minimal config; more coming soon
